VOITURE_LONGUEUR=5;VOLANT_INITIAL=-0.7;VOLANT_TIME=VOLANT_FINAL=0.7;ACCELERATEUR_FINAL=100;ACCELERATEUR_TIME=0.6;FREIN_FINAL=80;FREIN_TIME=0.4;STEPS=200;COEF_FROTEMENTS=7;V_MA=0.01;V_NULL=0.04;RENDER_STEPS=3;ZOOM=20;KEY_DOWN=40;KEY_UP=38;KEY_LEFT=37;KEY_RIGHT=39;function d(a,c,b){this.value=0;this.m=a;this.l=c;this.time=b;this.s=1}function f(a,c,b,e,h,g,t,u,v,w){this.a=a;this.b=c;this.h=b;this.i=e;this.d=h;this.e=g;this.f=t;this.g=u;this.r=v;this.c=w}
function k(a){a.value+=a.s*(a.l-a.m)/(STEPS*a.time);a.l>=a.m?a.value>a.l?a.value=a.l:a.value<a.m&&(a.value=a.m):a.value<a.l?a.value=a.l:a.value>a.m&&(a.value=a.m)}var l=[],m;for(m=0;128>m;m++)l[m]=0;
var n=0,p=new f(30,10,0,0,0,0,10,10+ZOOM*VOITURE_LONGUEUR,VOITURE_LONGUEUR,new function(a,c,b,e){this.j=a;this.p=c;this.q=b;this.k=e}(new d(VOLANT_INITIAL,VOLANT_FINAL,VOLANT_TIME),new d(0,ACCELERATEUR_FINAL,ACCELERATEUR_TIME),new d(0,FREIN_FINAL,FREIN_TIME),1)),q=new function(a,c,b,e){this.o=a;this.n=c;this.left=b;this.right=e}(0,0,0,0),r=new CollisionDetector(document.getElementById("car_image")),s=new CollisionDetector(document.getElementById("collMap_image"));s.t(0,0,0);
setInterval(function(){n++;0==n%STEPS&&(console.log("Tic"),n=0);var a=new f(parseFloat(p.a),parseFloat(p.b),parseFloat(p.h),parseFloat(p.i),parseFloat(p.d),parseFloat(p.e),parseFloat(p.f),parseFloat(p.g),parseFloat(p.r),p.c);a.d*a.d+a.e*a.e<V_MA&&(q.n&&(a.c.k=-1),q.o&&(a.c.k=1));var c=a.c,b=1==c.k?1:0;q.o&&b||q.n&&!b?k(c.p):c.p.value=0;q.n&&b||q.o&&!b?k(c.q):c.q.value=0;q.left&&(c.j.s=1,k(c.j));q.right&&(c.j.s=-1,k(c.j));c=a.a-a.f;b=a.b-a.g;b=0<b?Math.atan(c/b):Math.atan(c/b)+Math.PI;c=Math.sqrt(a.d*
a.d+a.e*a.e);a.d=a.c.k*c*Math.sin(b+a.c.j.value);a.e=a.c.k*c*Math.cos(b+a.c.j.value);var e,h,g;0==a.d&&0==a.e?b=c=g=0:(g=Math.sqrt(a.d*a.d+a.e*a.e),g<V_NULL?(b=c=g=0,a.d=0,a.e=0):(c=a.d/g,b=a.e/g));h=Math.sqrt((a.a-a.f)*(a.a-a.f)+(a.b-a.g)*(a.b-a.g));e=(a.a-a.f)/h;h=(a.b-a.g)/h;a.h=e*a.c.k*a.c.p.value;a.i=h*a.c.k*a.c.p.value;e=Math.pow(g,0.5);a.h-=e*c*a.c.q.value;a.i-=e*b*a.c.q.value;e=(1+Math.cos(a.c.j.value))/2*Math.pow(g,1);a.h-=COEF_FROTEMENTS*e*c;a.i-=COEF_FROTEMENTS*e*b;a.a+=(a.d+a.h/STEPS/
2)/STEPS;a.b+=(a.e+a.i/STEPS/2)/STEPS;a.d+=a.h/STEPS;a.e+=a.i/STEPS;b=Math.sqrt((a.a-a.f)*(a.a-a.f)+(a.b-a.g)*(a.b-a.g));c=(a.a-a.f)/b;b=(a.b-a.g)/b;a.f=a.a-a.r*c;a.g=a.b-a.r*b;c=0.48*ZOOM*a.a+0.52*ZOOM*a.f-88;b=0.48*ZOOM*a.b+0.52*ZOOM*a.g-85+45;g=a.a-a.f;e=a.b-a.g;r.t(c,b,-1*((0<e?Math.atan(g/e):Math.atan(g/e)+Math.PI)+Math.PI/2));r.u(s)?(p.d=0,p.e=0,p.h=0,p.i=0):(p.a=a.a,p.b=a.b,p.d=a.d,p.e=a.e,p.h=a.h,p.i=a.i,p.f=a.f,p.g=a.g)},1E3/STEPS);
setInterval(function(){var a,c;a=0.48*ZOOM*p.a+0.52*ZOOM*p.f-88;c=0.48*ZOOM*p.b+0.52*ZOOM*p.g-85+45;var b,e;b=p.a-p.f;e=p.b-p.g;b=0<e?Math.atan(b/e):Math.atan(b/e)+Math.PI;document.getElementById("car").style.webkitTransform="translate("+a+"px, "+c+"px) rotate("+-1*(180*b/Math.PI+90)+"deg)";document.getElementById("roues").style.webkitTransform="translate("+a+"px, "+c+"px) rotate("+-1*(180*b/Math.PI+90)+"deg)";document.getElementById("RG").style.webkitTransform="rotate("+(180*-p.c.j.value/Math.PI+
90)+"deg)";document.getElementById("RD").style.webkitTransform="rotate("+(180*-p.c.j.value/Math.PI+90)+"deg)"},20);document.addEventListener("keydown",function(a){if(!l[a.keyCode]){switch(a.keyCode){case KEY_UP:q.o=1;break;case KEY_DOWN:q.n=1;break;case KEY_LEFT:q.left=1;break;case KEY_RIGHT:q.right=1}l[a.keyCode]=1}},!1);
document.addEventListener("keyup",function(a){l[a.keyCode]=0;switch(a.keyCode){case KEY_UP:q.o=0;break;case KEY_DOWN:q.n=0;break;case KEY_LEFT:q.left=0;break;case KEY_RIGHT:q.right=0}},!1);